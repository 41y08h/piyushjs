---
title: "Build a blog with MDX in Next.js"
description: "This is a sample description"
date: "2021-03-21"
tags: ["react", "next.js", "mdx"]
image: "vercel.svg"
---

## Initial Setup

```bash
npx create-next-app sudentenland
cd sudentenland
npm run dev
```

import Counter from "@/blog-components/Counter";

<Counter />

These commands are pretty much self explanatory which initializes a new next.js app

## Before We Start the Tutorial {# before-we-start-the-tutorial}

## MDX with Next.js

0. Install required packages.

- `next-mdx-enhanced` allows us to extend the features of Next.js and work with MDX a lot easier.
- `next-compose-plugins` provides us an ease to configure plugins in Next.js.

```bash
npm i next-mdx-enhanced next-compose-plugins
```

1. Create the `next.config.js` file to tell what extended features and configurations do we need.

```js
// next.config.js
const withPlugins = require("next-compose-plugins");

const mdx = require("next-mdx-enhanced")({
  // This is the actual config that allows use to use layouts in MDX files
  defaultLayout: true,
  fileExtensions: ["mdx", "md"],
});

// Telling Next.js to treat mdx and other listed extensions as pages
const nextConfig = { pageExtensions: ["js", "jsx", "ts", "tsx", "mdx", "md"] };

module.exports = withPlugins(
  [
    mdx,
    // add more plugins here if you need to
  ],
  nextConfig
);
```

To understand this you have to have understanding of _plugins and loaders in module bundlers_ but if you don't understand what I said then just think of it as _extending features of Next.js_ and adding MDX that will allow us to _render mdx as pages directly_.

_Found a change in next.config.js. Restart the server to see the changes in effect._
That's what your terminal reports you when you do those changes so ...

`Ctrl` + `C` to stop the running server and

0. Create layouts/index.js directory to give a layout to blog posts.

```js
// layouts/index.js
export default function Index({ children }) {
  return children;
}
```

1. Create a new `.mdx` file (a blog post).
2. Restart your Next.js server.

Now you can navigate to `http://localhost:3000/blog/france` to see your blog post in action. At this point this blog website is very basic and we need to add more stuff to it.

## Blog Index

```bash
npm i gray-matter
```

```js
// lib/getPostBySlug.js
import { join } from "path";
import matter from "gray-matter";
import { promises as fs } from "fs";
import { postURL } from "../siteconfig";

const docsDirectory = join(process.cwd(), `pages/${postURL}`);

export default async function getPostBySlug(slug) {
  const realSlug = slug.replace(/\.mdx/, "");
  const fullPath = join(docsDirectory, `${realSlug}.mdx`);
  const fileContents = await fs.readFile(fullPath, "utf8");
  const { data, content } = matter(fileContents);

  return { slug: realSlug, meta: data, content };
}
```

```js
// lib/getAllPosts.js
import { promises as fs } from "fs";
import getPostBySlug from "./getPostBySlug";
import { postURL } from "../siteconfig";

export default async function getAllPosts() {
  const path = require("path");
  const postsDirectory = path.join(process.cwd(), `pages/${postURL}`);
  const filenames = await fs.readdir(postsDirectory);

  const posts = filenames.map(getPostBySlug);

  return await Promise.all(posts);
}
```
